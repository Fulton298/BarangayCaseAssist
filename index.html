<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Barangay Case Analyzer</title>
    <!-- Bootstrap CSS for responsive, modern form design -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Custom styles -->
    <link rel="stylesheet" href="style.css" />

    <!-- Progressive Web App Manifest -->
    <link rel="manifest" href="manifest.json" />
    <!-- Configure PWA theme color -->
    <meta name="theme-color" content="#0d6efd" />
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light shadow-sm mb-4">
      <div class="container">
        <a class="navbar-brand d-flex align-items-center" href="#">
          <img
            src="./assets/icon.png"
            alt="Barangay Case Analyzer Icon"
            width="40"
            height="40"
            class="me-2 rounded"
          />
          <span class="fs-4 fw-bold">Barangay Case Analyzer</span>
        </a>
      </div>
    </nav>
    <main class="container mb-5">
      <!-- Intro message -->
      <p class="lead">
        Fill in the details below to generate a comprehensive case report for
        barangay mediation and legal analysis. Fields marked with
        <span class="text-danger">*</span> are required.
      </p>
      <form id="caseForm" novalidate>
        <!-- Case Information -->
        <section class="mb-4">
          <h4>Case Information (optional)</h4>
          <div class="row g-3">
            <div class="col-md-6">
              <label for="caseId" class="form-label">Case ID</label>
              <input
                type="text"
                class="form-control"
                id="caseId"
                name="caseId"
                placeholder="e.g., 2025-001"
              />
            </div>
            <div class="col-md-6">
              <label for="dateReceived" class="form-label">Date Received</label>
              <input
                type="date"
                class="form-control"
                id="dateReceived"
                name="dateReceived"
              />
            </div>
          </div>
        </section>
        <!-- Complainant Information -->
        <section class="mb-4">
          <h4>Complainant Information (optional)</h4>
          <div class="row g-3">
            <div class="col-md-6">
              <label for="complainantName" class="form-label">Full Name</label>
              <input
                type="text"
                class="form-control"
                id="complainantName"
                name="complainantName"
                placeholder="e.g., Juan dela Cruz"
              />
            </div>
            <div class="col-md-6">
              <label for="complainantPhone" class="form-label">Phone Number</label>
              <input
                type="tel"
                class="form-control"
                id="complainantPhone"
                name="complainantPhone"
                placeholder="09XX XXX XXXX"
              />
            </div>
            <div class="col-md-6">
              <label for="complainantEmail" class="form-label">Email Address</label>
              <input
                type="email"
                class="form-control"
                id="complainantEmail"
                name="complainantEmail"
                placeholder="name@example.com"
              />
            </div>
            <div class="col-md-6">
              <label for="complainantAddress" class="form-label"
                >Complete Address</label
              >
              <textarea
                class="form-control"
                id="complainantAddress"
                name="complainantAddress"
                rows="2"
                placeholder="House No., Street, Barangay, City"
              ></textarea>
            </div>
          </div>
        </section>
        <!-- Respondent Information -->
        <section class="mb-4">
          <h4>Respondent Information (optional)</h4>
          <div id="respondentContainer">
            <!-- Respondent template (cloned dynamically) -->
            <div class="respondent mb-3 border rounded p-3">
              <div class="d-flex justify-content-between align-items-center mb-2">
                <h6 class="mb-0">Respondent <span class="respondent-index">1</span></h6>
                <button
                  type="button"
                  class="btn btn-sm btn-outline-danger remove-respondent"
                  title="Remove respondent"
                  style="display: none;"
                >
                  Remove
                </button>
              </div>
              <div class="row g-3">
                <div class="col-md-6">
                  <label class="form-label">Full Name</label>
                  <input
                    type="text"
                    class="form-control respondent-name"
                    placeholder="e.g., Pedro Santos"
                  />
                </div>
                <div class="col-md-6">
                  <label class="form-label">Phone Number</label>
                  <input
                    type="tel"
                    class="form-control respondent-phone"
                    placeholder="09XX XXX XXXX"
                  />
                </div>
                <div class="col-md-6">
                  <label class="form-label">Email Address</label>
                  <input
                    type="email"
                    class="form-control respondent-email"
                    placeholder="name@example.com"
                  />
                </div>
                <div class="col-md-6">
                  <label class="form-label">Complete Address</label>
                  <textarea
                    class="form-control respondent-address"
                    rows="2"
                    placeholder="House No., Street, Barangay, City"
                  ></textarea>
                </div>
              </div>
            </div>
          </div>
          <button
            type="button"
            class="btn btn-sm btn-outline-primary"
            id="addRespondentBtn"
          >
            + Add Another Respondent
          </button>
        </section>
        <!-- Case Details (required) -->
        <section class="mb-4">
          <h4>Case Details <span class="text-danger">*</span></h4>
          <div class="mb-3">
            <label for="incidentSummary" class="form-label"
              >Summary of the Incident</label
            >
            <textarea
              class="form-control"
              id="incidentSummary"
              name="incidentSummary"
              rows="4"
              placeholder="Describe what happened in detail..."
              required
            ></textarea>
            <div class="invalid-feedback">
              Please provide a summary of the incident (minimum 30
              characters).
            </div>
          </div>
          <div class="mb-3">
            <label for="incidentLocation" class="form-label"
              >Location of the Incident</label
            >
            <input
              type="text"
              class="form-control"
              id="incidentLocation"
              name="incidentLocation"
              placeholder="Specific address or landmark in San Pedro, Laguna"
              required
            />
            <div class="invalid-feedback">
              Please specify the location of the incident.
            </div>
          </div>
          <div class="mb-3">
            <label for="incidentDateTime" class="form-label"
              >Date and Time of the Incident</label
            >
            <input
              type="datetime-local"
              class="form-control"
              id="incidentDateTime"
              name="incidentDateTime"
              required
            />
            <div class="invalid-feedback">
              Please provide the date and time of the incident.
            </div>
          </div>
        </section>
        <!-- Buttons -->
        <div class="d-flex gap-3 mb-5">
          <button type="button" class="btn btn-primary" id="generateBtn">
            Generate Report
          </button>
          <button type="reset" class="btn btn-secondary" id="clearBtn">
            Clear Form
          </button>
        </div>
      </form>
      <!-- Generated report section -->
      <section id="reportSection" class="d-none">
        <div class="card shadow-sm">
          <div class="card-body" id="reportContent">
            <!-- The generated report will be inserted here -->
          </div>
        </div>
        <div class="mt-3 d-flex gap-3">
          <button
            type="button"
            class="btn btn-success"
            id="downloadPdfBtn"
          >
            Download PDF
          </button>
          <button type="button" class="btn btn-outline-secondary" id="printBtn">
            Print Report
          </button>
        </div>
      </section>

      <!-- Legal research section -->
      <section class="card" id="legal-research">
        <h2>Legal Research (PH sources)</h2>
        <div class="row" style="gap:.5rem; align-items:center;">
          <input id="legal-query" type="text"
                 placeholder="e.g., G.R. No. 116124; barangay amicable settlement; KP Law jurisdiction"
                 class="input" style="flex:1; min-width:280px;" />
          <button type="button" onclick="startLegalSearch()">Search Sources</button>
        </div>
        <div id="legal-results" class="results" style="margin-top:0.75rem;"></div>
        <!-- Attached citations will appear here -->
        <ul id="citationsList" class="list-unstyled" style="margin-top:0.5rem;"></ul>
        <p class="muted" style="margin-top:.5rem;">
          Sources: Lawphil, ChanRobles, Supreme Court, Court of Appeals, Official Gazette, etc.
        </p>
      </section>
    </main>
    <!-- Bootstrap JS (optional for some interactions) -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
    ></script>
    <!-- jsPDF and html2canvas libraries for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- App logic -->
    <script src="script.js"></script>

    <!-- Legal search configuration and behavior -->
    <script src="config.js"></script>
    <script src="research.js"></script>

    <!-- Register service worker for PWA support -->
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', function () {
          // Use relative path for GitHub Pages
          navigator.serviceWorker.register('sw.js').catch(function (error) {
            console.error('Service worker registration failed:', error);
          });
        });
      }
    </script>
  </body>
</html>